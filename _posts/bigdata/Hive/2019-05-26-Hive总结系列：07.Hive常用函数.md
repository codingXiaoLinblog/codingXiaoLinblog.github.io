---
layout: post
title:  "Hive总结系列：07.Hive常用函数"
date:   2019-05-26 15:34:30
categories: Hive
tags: Hive
author: wql
---

* content
{:toc}
本篇文章主要总结一些Hive常见的查询操作。






## 1.关系运算
### 1.1 空值(非空)判断
空值(非空)判断: IS NULL / IS NOT NULL         
语法: A IS NULL / IS NOT NULL     
操作类型: 所有类型      
描述: 如果表达式A的值为NULL，则为TRUE；否则为FALSE       
```sql
hive> select A from iteblog where A is null;
```
### LIKE比较: LIKE
语法: A LIKE B
操作类型: strings
描述: 如果字符串A或者字符串B为NULL，则返回NULL；如果字符串A符合表达式B 的正则语法，则为TRUE；否则为FALSE。B中字符”_”表示任意单个字符，而字符”%”表示任意数量的字符。
```sql
hive> select 1 from iteblog where 'football' like 'foot%';
1
hive> select 1 from iteblog where 'football' like 'foot____';
1
<strong>注意：否定比较时候用NOT A LIKE B</strong>
hive> select 1 from iteblog where NOT 'football' like 'fff%';
1
```
## 2.数值计算
### 1、取整函数: round
语法: round(double a)         
返回值: BIGINT         
说明: 返回double类型的整数值部分 （遵循四舍五入）           
```sql
hive> select round(3.1415926) from iteblog;
3
hive> select round(3.5) from iteblog;
4
hive> create table iteblog as select round(9542.158) from iteblog;
hive> describe iteblog;
_c0     bigint
```
### 2、指定精度取整函数: round
语法: round(double a, int d)      
返回值: DOUBLE         
说明: 返回指定精度d的double类型        
```sql
hive> select round(3.1415926,4) from iteblog;
3.1416
```
### 3、向下取整函数: floor
语法: floor(double a)         
返回值: BIGINT         
说明: 返回等于或者小于该double变量的最大的整数         
```sql
hive> select floor(3.1415926) from iteblog;
3
hive> select floor(25) from iteblog;
25
```

### 4、向上取整函数: ceil
语法: ceil(double a)      
返回值: BIGINT         
说明: 返回等于或者大于该double变量的最小的整数         
```sql
hive> select ceil(3.1415926) from iteblog;
4
hive> select ceil(46) from iteblog;
46
```
### 5、取随机数函数: rand
语法: rand(),rand(int seed)           
返回值: double         
说明: 返回一个0到1范围内的随机数。如果指定种子seed，则会等到一个稳定的随机数序列            
```sql
hive> select rand() from iteblog;
0.5577432776034763
hive> select rand() from iteblog;
0.6638336467363424
```
## 3.时间函数
### 1、获取当前时间
```sql
语法: 1. CURRENT_DATE/current_date()	// SELECT current_date()      2019-04-02
  2.current_timestamp()				// SELECT current_timestamp()   2019-04-02 17:53:06.138   
注意：时间格式为：YYYY-MM-dd
```
### 2、日期增加/减少函数: date_add/date_sub      
语法: date_add(string startdate, int days)，date_sub (string startdate, int days)          
返回值: string         
说明: 返回开始日期startdate增加days天后的日期，返回开始日期startdate减少days天后的日期。      
```sql
hive> select date_add('2012-12-08',10)2012-12-18hive> select date_sub('2012-12-08',10)2012-11-28
```

### 3、日期时间转日期函数: to_date
语法: to_date(string timestamp)           
返回值: string         
说明: 返回日期时间字段中的日期部分。         
```sql
hive> select to_date('2011-12-08 10:03:01')2011-12-08
```

### 4、UNIX时间戳转日期函数: from_unixtime   
语法: from_unixtime(bigint unixtime，[string format])      
返回值: string         
说明: 转化UNIX时间戳（从1970-01-01 00:00:00 UTC到指定时间的秒数）到当前时区的时间格式       
```sql
 
```
hive> select from_unixtime(1323308943,'yyyyMMdd')20111208
5、日期转UNIX时间戳函数: unix_timestamp
语法: unix_timestamp(string date)，unix_timestamp(string date, string pattern)
返回值: bigint
说明: 转换pattern格式的日期到UNIX时间戳。如果转化失败，则返回0。
hive> select unix_timestamp() //获取当前时区的时间戳1554219294 hive> select unix_timestamp('2011-12-07 13:01:03')//yyyy-MM-dd HH:mm:ss1323234063 hive> select unix_timestamp('20111207 13:01:03','yyyyMMdd HH:mm:ss')1323234063
注：unix_timestamp(string date)函数，输入的日期格式默认为："yyyy-MM-dd HH:mm:ss"
6、日期转年月周日时分秒函数: year/month/weekofyear/day/hour/minute/second
语法: year(string date)，month (string date)，day (string date)，hour (string date)，minute (string date)，second (string date)，weekofyear (string date)
返回值: int
说明: 返回日期中的年月周日时分秒。
hive> select year('2011-12-08 10:03:01') //2011hive> select month('2011-08-08')   //8  注意,月份格式 hive> select day('2011-12-24')     // 24 hive> select hour('2011-12-08 10:03:01') //10hive> select minute('2011-08-08')   //8  注意,月份格式 hive> select second('2011-12-24')     // 24 hive> select weekofyear('2011-12-08 10:03:01') //49hive> 
7、日期比较函数: datediff
语法: datediff(string enddate, string startdate)
返回值: int
说明: 返回结束日期减去开始日期的天数。
hive> select datediff('2012-12-08','2012-05-09')213
8、日期函数常见场景：
上个月：substr(regexp_replace(add_months(current_date,-1),'-',''),0,6)
当月第1天: date_sub(current_date,dayofmonth(current_date)-1)
下个月第1天: `add_months(date_sub(current_date,dayofmonth(current_date)-1),1)


